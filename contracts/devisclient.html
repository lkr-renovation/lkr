<!DOCTYPE html>
<html lang="fr">
<head>
<!-- Website designed and developed by Riccardo Barlozzetti -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEVIS - LKR RENOVATION MC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 50px 60px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* HEADER */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding-bottom: 20px;
            border-bottom: 3px solid #c41e3a;
            margin-bottom: 30px;
        }

        .header-left img {
            height: 60px;
            width: auto;
        }

        .header-right {
            text-align: right;
            font-size: 12px;
            line-height: 1.8;
        }

        .header-right strong {
            display: block;
            font-size: 14px;
            color: #c41e3a;
            margin-bottom: 5px;
        }

        /* TITRE */
        h1 {
            text-align: center;
            color: #c41e3a;
            font-size: 26px;
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }

        /* SECTION INFO DEVIS */
        .devis-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .devis-info-right {
            text-align: right;
            background: #f9f9f9;
            padding: 20px;
            border-left: 4px solid #c41e3a;
        }

        .devis-info-right div {
            margin-bottom: 10px;
        }

        .devis-info-right label {
            font-weight: 600;
            margin-right: 10px;
            color: #c41e3a;
        }

        .devis-info-right input {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            width: 200px;
        }

        /* SECTION CLIENT */
        .client-section {
            background: #f9f9f9;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
            border-left: 4px solid #c41e3a;
        }

        .client-section h3 {
            color: #c41e3a;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .client-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .client-section label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .client-section input,
        .client-section textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
            font-family: inherit;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* SECTION PROJET */
        .projet {
            background: #fff;
            padding: 20px;
            margin-bottom: 30px;
            border: 2px solid #c41e3a;
            border-radius: 5px;
        }

        .projet h3 {
            color: #c41e3a;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .projet label {
            display: block;
            font-weight: 600;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        .projet input,
        .projet textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
            font-family: inherit;
        }

        .projet textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* TABLEAU D√âTAILL√â */
        .table-container {
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        thead th {
            background: #c41e3a;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #a01830;
        }

        tbody td {
            border: 1px solid #ddd;
            padding: 10px;
            background: white;
        }

        tbody tr:hover {
            background: #fafafa;
        }

        .col-num {
            width: 5%;
            text-align: center;
            font-weight: 600;
        }

        .col-designation {
            width: 40%;
        }

        .col-qte {
            width: 10%;
        }

        .col-unite {
            width: 10%;
        }

        .col-prix {
            width: 15%;
        }

        .col-total {
            width: 15%;
            text-align: right;
            font-weight: 600;
        }

        .col-actions {
            width: 5%;
            text-align: center;
        }

        table input,
        table select {
            width: 100%;
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
        }

        table input[type="number"] {
            text-align: right;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .btn-add-row {
            display: inline-block;
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }

        .btn-add-row:hover {
            background: #218838;
        }

        /* TOTAUX */
        .totaux {
            text-align: right;
            background: #f9f9f9;
            padding: 20px;
            border-left: 4px solid #c41e3a;
            margin-bottom: 30px;
        }

        .totaux-row {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .totaux-label {
            font-weight: 600;
            margin-right: 20px;
            min-width: 120px;
        }

        .totaux-value {
            min-width: 150px;
            text-align: right;
        }

        .totaux-separator {
            border-top: 2px solid #c41e3a;
            margin: 15px 0;
        }

        .total-ttc {
            font-size: 20px;
            font-weight: 700;
            color: #c41e3a;
        }

        /* MODALIT√âS PAIEMENT */
        .paiement {
            background: #fffef0;
            border: 2px solid #ffc107;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .paiement h3 {
            color: #c41e3a;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .paiement-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .paiement-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ffc107;
        }

        .paiement-item strong {
            display: block;
            color: #c41e3a;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .paiement-item small {
            color: #666;
            font-size: 12px;
        }

        /* CONDITIONS */
        .conditions {
            background: #f9f9f9;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
            font-size: 13px;
        }

        .conditions h3 {
            color: #c41e3a;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .conditions ul {
            list-style: none;
            padding-left: 0;
        }

        .conditions li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .conditions li:before {
            content: "‚úì";
            color: #c41e3a;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* GARANTIES */
        .garanties {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .garantie-box {
            background: #e8f5e9;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 5px;
        }

        .garantie-box h4 {
            color: #28a745;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .garantie-box p {
            font-size: 12px;
            line-height: 1.6;
        }

        /* SIGNATURES */
        .signatures {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            margin-top: 40px;
            page-break-inside: avoid;
        }

        .signature-box h4 {
            font-size: 14px;
            margin-bottom: 15px;
            color: #c41e3a;
        }

        .signature-box input,
        .signature-box select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .signature-space {
            height: 100px;
            border: 2px dashed #ccc;
            background: #fafafa;
            margin: 20px 0 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
            font-style: italic;
        }

        /* FOOTER */
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 3px solid #c41e3a;
            text-align: center;
            font-size: 11px;
            color: #666;
            line-height: 1.8;
        }

        /* BOUTON PRINT */
        .btn-print {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #c41e3a;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.3);
            z-index: 1000;
        }

        .btn-print:hover {
            background: #a01830;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 30, 58, 0.4);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }

            .header {
                flex-direction: column;
                gap: 20px;
            }

            .header-right {
                text-align: left;
            }

            .client-grid,
            .paiement-grid,
            .garanties,
            .signatures,
            .devis-info {
                grid-template-columns: 1fr;
            }

            .devis-info-right {
                text-align: left;
            }

            .devis-info-right input {
                width: 100%;
            }

            table {
                font-size: 11px;
            }

            .btn-print {
                bottom: 20px;
                right: 20px;
                padding: 12px 20px;
                font-size: 14px;
            }
        }

        /* PRINT STYLES */
        @media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                max-width: 100%;
                padding: 15mm;
                box-shadow: none;
            }

            .btn-print,
            .btn-add-row,
            .btn-delete,
            .no-print {
                display: none !important;
            }

            .header,
            .client-section,
            .projet,
            .table-container,
            .paiement,
            .signatures {
                page-break-inside: avoid;
            }

            table input,
            table select,
            input,
            textarea,
            select {
                border: none !important;
                border-bottom: 1px solid #ddd !important;
                background: transparent !important;
                padding: 2px 0 !important;
            }

            .signature-space {
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-left">
                <img src="https://lkr.mc/img/LKRorizzontalepiccolo.png" alt="LKR Renovation MC">
            </div>
            <div class="header-right">
                <strong>LKR RENOVATION MC SARL</strong>
                General Contractor<br>
                38, Boulevard des Moulins<br>
                98000 Monaco<br>
                RCI: 25S10110 | TVA: FR72000188879<br>
                +377 6 40 61 56 50<br>
                info@lkr.mc | www.lkr.mc
            </div>
        </div>

        <!-- TITRE -->
        <h1>DEVIS</h1>

        <!-- INFO DEVIS -->
        <div class="devis-info">
            <div></div>
            <div class="devis-info-right">
                <div>
                    <label>DEVIS N¬∞:</label>
                    <input type="text" id="devisNum" placeholder="Ex: DEV-2025-001">
                </div>
                <div>
                    <label>Date:</label>
                    <input type="date" id="devisDate">
                </div>
                <div>
                    <label>Validit√©:</label>
                    <input type="number" id="devisValidite" value="30" style="width: 80px;"> jours
                </div>
                <div>
                    <label>R√©f√©rence:</label>
                    <input type="text" id="devisRef" placeholder="Ex: MONACO-APT-2025">
                </div>
            </div>
        </div>

        <!-- CLIENT -->
        <div class="client-section">
            <h3>CLIENT</h3>
            <div class="client-grid">
                <div>
                    <label>Nom / Raison sociale *</label>
                    <input type="text" id="clientNom" required placeholder="M./Mme/Soci√©t√©">
                </div>
                <div>
                    <label>Pr√©nom</label>
                    <input type="text" id="clientPrenom" placeholder="(si particulier)">
                </div>
                <div class="full-width">
                    <label>Adresse du client</label>
                    <input type="text" id="clientAdresse" placeholder="Adresse compl√®te">
                </div>
                <div>
                    <label>Email</label>
                    <input type="email" id="clientEmail" placeholder="email@exemple.com">
                </div>
                <div>
                    <label>T√©l√©phone</label>
                    <input type="tel" id="clientTel" placeholder="+377 ou +33">
                </div>
            </div>
        </div>

        <!-- PROJET -->
        <div class="projet">
            <h3>DESCRIPTION DU PROJET</h3>
            <label>Intitul√© du projet</label>
            <input type="text" id="projetTitre" placeholder="Ex: R√©novation compl√®te appartement 3 pi√®ces">
            
            <label>Lieu des travaux</label>
            <input type="text" id="projetLieu" placeholder="Adresse pr√©cise du chantier">
            
            <label>Description d√©taill√©e des travaux</label>
            <textarea id="projetDesc" placeholder="D√©crivez en d√©tail les travaux √† r√©aliser: pi√®ces concern√©es, √©tat actuel, modifications souhait√©es, finitions, √©quipements..."></textarea>
        </div>

        <!-- TABLEAU D√âTAILL√â -->
        <h3 style="color: #c41e3a; margin-bottom: 15px;">D√âTAIL DES PRESTATIONS</h3>
        <div class="table-container">
            <table id="devisTable">
                <thead>
                    <tr>
                        <th class="col-num">N¬∞</th>
                        <th class="col-designation">D√©signation / Description</th>
                        <th class="col-qte">Qt√©</th>
                        <th class="col-unite">Unit√©</th>
                        <th class="col-prix">Prix Unit. HT (‚Ç¨)</th>
                        <th class="col-total">Total HT (‚Ç¨)</th>
                        <th class="col-actions no-print"></th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Les lignes seront g√©n√©r√©es par JS -->
                </tbody>
            </table>
        </div>
        <button class="btn-add-row no-print" onclick="ajouterLigne()">+ AJOUTER UNE PRESTATION</button>

        <!-- TOTAUX -->
        <div class="totaux">
            <div class="totaux-row">
                <span class="totaux-label">TOTAL HT:</span>
                <span class="totaux-value" id="totalHT">0,00 ‚Ç¨</span>
            </div>
            <div class="totaux-row">
    <span class="totaux-label">TVA applicable: 20%</span>
    <span class="totaux-value" id="totalTVA">0,00 ‚Ç¨</span>
</div>
<div style="text-align: right; font-size: 10px; color: #666; font-style: italic; margin-top: -5px; margin-bottom: 10px;">
    (adapt√©e selon r√©gime fiscal client et lieu livraison conform√©ment Accord France-Monaco 1963 et Ordonnance 7.378/1963)
</div>
            <div class="totaux-separator"></div>
            <div class="totaux-row total-ttc">
                <span class="totaux-label">TOTAL TTC:</span>
                <span class="totaux-value" id="totalTTC">0,00 ‚Ç¨</span>
            </div>
        </div>

        <!-- MODALIT√âS DE PAIEMENT -->
        <div class="paiement">
            <h3>MODALIT√âS DE PAIEMENT</h3>
            <div class="no-print" style="margin-bottom: 15px;">
                <label for="paiementSelect" style="font-weight: 600; color: #c41e3a;">S√©lectionner un √©ch√©ancier:</label>
                <select id="paiementSelect" onchange="updatePaiementDetails(this.value)" style="padding: 8px; border: 1px solid #ddd; border-radius: 3px; width: 100%; max-width: 300px; margin-top: 5px;">
                    <option value="standard">Standard (30% / 40% / 30%)</option>
                    <option value="saldo">Solde √† la livraison (100% √† la fin)</option>
                    <option value="anticipo">100% en avance (R√©duction de 5%)</option>
                    <option value="trenta-settanta">30% / 70%</option>
                    <option value="personnalise">Personnalis√© (√âcrire ci-dessous)</option>
                </select>
            </div>
            
            <div id="paiementDetails">
                <!-- Dettagli di pagamento predefiniti (Standard) -->
                <p style="margin-bottom: 10px;">√âch√©ancier standard pour ce type de projet:</p>
                <div class="paiement-grid">
                    <div class="paiement-item">
                        <strong>30%</strong>
                        <small>√Ä la signature du devis<br>(Acompte)</small>
                    </div>
                    <div class="paiement-item">
                        <strong>40%</strong>
                        <small>√Ä mi-parcours des travaux<br>(Situation d'avancement)</small>
                    </div>
                    <div class="paiement-item">
                        <strong>30%</strong>
                        <small>√Ä la livraison finale<br>(Solde)</small>
                    </div>
                </div>
            </div>
            
            <div id="paiementCustom" style="display: none; margin-top: 15px;">
                <label for="paiementCustomText" style="font-weight: 600; color: #c41e3a;">D√©tails de l'√©ch√©ancier personnalis√©:</label>
                <textarea id="paiementCustomText" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 3px; font-family: inherit;"></textarea>
            </div>
            <p style="margin-top: 15px; font-size: 12px; color: #666;">
                <strong>Modes de paiement accept√©s:</strong> Virement bancaire, Ch√®que<br>
                <strong>D√©lais:</strong> Paiement sous 7 jours √† r√©ception de facture
            </p>
        </div>

        <!-- GARANTIES -->
        <div class="garanties">
            <div class="garantie-box">
                <h4>‚úì ASSURANCE D√âCENNALE</h4>
                <p>LKR Renovation est couvert par une assurance d√©cennale pour tous les travaux de construction et de r√©novation structurelle.</p>
            </div>
            <div class="garantie-box">
                <h4>‚úì GARANTIE DE PARFAIT ACH√àVEMENT</h4>
                <p>Garantie d'un an sur tous les travaux r√©alis√©s. Intervention rapide pour toute malfa√ßon constat√©e.</p>
            </div>
        </div>

        <!-- CONDITIONS G√âN√âRALES -->
        <div class="conditions">
            <h3>CONDITIONS G√âN√âRALES</h3>
            <ul>
                <li>Devis valable <strong id="validiteDays">30</strong> jours √† compter de la date d'√©mission</li>
                <li>Prix exprim√©s en Euros TTC (Toutes Taxes Comprises), TVA √† 20%</li>
                <li>D√©but des travaux: sous 15 jours apr√®s signature et r√©ception de l'acompte</li>
                <li>Dur√©e estim√©e des travaux: √† d√©finir selon planning √©tabli</li>
                <li>Mat√©riaux: de premi√®re qualit√©, conformes aux normes en vigueur √† Monaco</li>
                <li>Modifications: toute modification en cours de chantier fera l'objet d'un avenant √©crit</li>
                <li>Acc√®s au chantier: le client s'engage √† garantir l'acc√®s au chantier durant toute la dur√©e des travaux</li>
                <li>√âvacuation des d√©chets: incluse dans le prix (selon r√©glementation mon√©gasque)</li>
                <li>Assurances: LKR dispose d'une assurance responsabilit√© civile professionnelle et d√©cennale</li>
                <li>Litige: en cas de diff√©rend, juridiction comp√©tente de la Principaut√© de Monaco</li>
            </ul>
        </div>

        <!-- SIGNATURES -->
        <div class="signatures">
            <!-- LKR -->
            <div class="signature-box">
                <h4>POUR LKR RENOVATION MC SARL</h4>
                <label style="font-size: 12px;">Signataire:</label>
                <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 3px; margin-bottom: 10px;">
                    <option>M. Luca Borella, G√©rant</option>
                    <option>M. Riccardo Barlozzetti, Associ√©</option>
                </select>
                <label style="font-size: 12px;">Date:</label>
                <input type="date">
                <div class="signature-space">
                    Signature et cachet de l'entreprise
                </div>
            </div>

            <!-- CLIENT -->
            <div class="signature-box">
                <h4>BON POUR ACCORD CLIENT</h4>
                <label style="font-size: 12px;">Nom et pr√©nom:</label>
                <input type="text" placeholder="Identit√© du signataire">
                <label style="font-size: 12px;">Date:</label>
                <input type="date">
                <div class="signature-space">
                    Signature pr√©c√©d√©e de la mention<br>"Lu et approuv√© - Bon pour accord"
                </div>
                <p style="font-size: 11px; color: #666; margin-top: 10px; font-style: italic;">
                    En signant ce devis, le client reconna√Æt en avoir pris connaissance et l'accepte dans son int√©gralit√©.
                </p>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <strong>LKR RENOVATION MC SARL</strong> | General Contractor | SARL au capital de 15.000‚Ç¨<br>
            38, Boulevard des Moulins, 98000 Monaco<br>
            RCI: 25S10110 | TVA: FR72000188879<br>
            +377 6 40 61 56 50 | info@lkr.mc | www.lkr.mc<br>
            <em style="margin-top: 10px; display: block;">R√©novation ‚Ä¢ Construction ‚Ä¢ Coordination de travaux</em>
        </div>
    </div>

    <!-- BOUTON PRINT -->
    <button class="btn-print no-print" onclick="imprimer()">üñ®Ô∏è Imprimer / PDF</button>

    <script>
        // INIT: Date automatique et cr√©ation lignes initiales
        document.addEventListener('DOMContentLoaded', function() {
            // Date du jour
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('devisDate').value = today;
            
            // Cr√©er 10 lignes initiales
            for (let i = 0; i < 10; i++) {
                creerLigne();
            }
            
            // Listener sur validit√© pour mettre √† jour texte
            document.getElementById('devisValidite').addEventListener('input', function() {
                document.getElementById('validiteDays').textContent = this.value;
            });
            
            calculerTotaux();
        });

        // Compteur ligne
        let ligneCounter = 1;

        // CR√âER UNE NOUVELLE LIGNE
        function creerLigne() {
            const tbody = document.getElementById('tableBody');
            const row = tbody.insertRow();
            const num = ligneCounter++;
            
            row.innerHTML = `
                <td class="col-num">${num}</td>
                <td class="col-designation">
                    <input type="text" class="designation" placeholder="Description d√©taill√©e de la prestation">
                </td>
                <td class="col-qte">
                    <input type="number" class="qte" min="0" step="0.01" value="0" oninput="calculerLigne(this)">
                </td>
                <td class="col-unite">
                    <select class="unite">
                        <option value="fft">fft (forfait)</option>
                        <option value="m¬≤">m¬≤</option>
                        <option value="ml">ml (m√®tre lin√©aire)</option>
                        <option value="u">u (unit√©)</option>
                        <option value="ens">ens (ensemble)</option>
                        <option value="j">j (jour)</option>
                        <option value="h">h (heure)</option>
                    </select>
                </td>
                <td class="col-prix">
                    <input type="number" class="prix" min="0" step="0.01" value="0" oninput="calculerLigne(this)">
                </td>
                <td class="col-total">
                    <span class="total-ligne">0,00</span>
                </td>
                <td class="col-actions no-print">
                    <button class="btn-delete" onclick="supprimerLigne(this)" title="Supprimer la ligne">üóëÔ∏è</button>
                </td>
            `;
            
            return row;
        }

        // AJOUTER UNE LIGNE
        function ajouterLigne() {
            creerLigne();
            calculerTotaux();
        }

        // SUPPRIMER UNE LIGNE
        function supprimerLigne(btn) {
            const tbody = document.getElementById('tableBody');
            // Garder au moins 1 ligne
            if (tbody.rows.length > 1) {
                btn.closest('tr').remove();
                // Renum√©roter les lignes
                renumeroterLignes();
                calculerTotaux();
            } else {
                alert('Vous devez garder au moins une ligne dans le devis.');
            }
        }

        // RENUM√âROTER LES LIGNES
        function renumeroterLignes() {
            const tbody = document.getElementById('tableBody');
            Array.from(tbody.rows).forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
        }

        // LOGICA PAGAMENTO
        function updatePaiementDetails(mode) {
            const detailsDiv = document.getElementById('paiementDetails');
            const customDiv = document.getElementById('paiementCustom');
            const customTextarea = document.getElementById('paiementCustomText');
            
            // Nascondi tutto
            detailsDiv.innerHTML = '';
            customDiv.style.display = 'none';
            
            let htmlContent = '';
            
            switch (mode) {
                case 'standard':
                    htmlContent = `
                        <p style="margin-bottom: 10px;">√âch√©ancier standard pour ce type de projet:</p>
                        <div class="paiement-grid">
                            <div class="paiement-item">
                                <strong>30%</strong>
                                <small>√Ä la signature du devis<br>(Acompte)</small>
                            </div>
                            <div class="paiement-item">
                                <strong>40%</strong>
                                <small>√Ä mi-parcours des travaux<br>(Situation d'avancement)</small>
                            </div>
                            <div class="paiement-item">
                                <strong>30%</strong>
                                <small>√Ä la livraison finale<br>(Solde)</small>
                            </div>
                        </div>
                    `;
                    break;
                case 'saldo':
                    htmlContent = `
                        <p style="margin-bottom: 10px;">Modalit√©: Solde √† la livraison</p>
                        <div class="paiement-grid" style="grid-template-columns: 1fr;">
                            <div class="paiement-item">
                                <strong>100%</strong>
                                <small>√Ä la livraison finale<br>(Solde)</small>
                            </div>
                        </div>
                    `;
                    break;
                case 'anticipo':
                    htmlContent = `
                        <p style="margin-bottom: 10px;">Modalit√©: Paiement 100% anticip√© (avec r√©duction)</p>
                        <div class="paiement-grid" style="grid-template-columns: 1fr;">
                            <div class="paiement-item">
                                <strong>100%</strong>
                                <small>√Ä la signature du devis<br>(R√©duction de 5% appliqu√©e sur le Total HT)</small>
                            </div>
                        </div>
                    `;
                    break;
                case 'trenta-settanta':
                    htmlContent = `
                        <p style="margin-bottom: 10px;">√âch√©ancier 30% / 70%:</p>
                        <div class="paiement-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="paiement-item">
                                <strong>30%</strong>
                                <small>√Ä la signature du devis<br>(Acompte)</small>
                            </div>
                            <div class="paiement-item">
                                <strong>70%</strong>
                                <small>√Ä la livraison finale<br>(Solde)</small>
                            </div>
                        </div>
                    `;
                    break;
                case 'personnalise':
                    customDiv.style.display = 'block';
                    htmlContent = `
                        <p style="margin-bottom: 10px;">√âch√©ancier personnalis√©:</p>
                        <div class="paiement-custom-output" id="paiementCustomOutput">${customTextarea.value.trim() || 'D√©tails √† compl√©ter manuellement'}</div>
                    `;
                    // Aggiungi un listener per aggiornare l'output in tempo reale
                    customTextarea.oninput = () => {
                        document.getElementById('paiementCustomOutput').textContent = customTextarea.value.trim() || 'D√©tails √† compl√©ter manuellement';
                    };
                    break;
            }
            
            detailsDiv.innerHTML = htmlContent;
        }
        
        // Inizializza al caricamento
        document.addEventListener('DOMContentLoaded', () => {
            updatePaiementDetails(document.getElementById('paiementSelect').value);
        });

        // CALCULER UNE LIGNE
        function calculerLigne(input) {
            try {
                const row = input.closest('tr');
                const qte = parseFloat(row.querySelector('.qte').value) || 0;
                const prix = parseFloat(row.querySelector('.prix').value) || 0;
                const total = qte * prix;
                
                row.querySelector('.total-ligne').textContent = formaterNombre(total);
                
                calculerTotaux();
            } catch (error) {
                console.warn('Erreur calcul ligne:', error);
            }
        }

        // CALCULER TOTAUX GLOBAUX
        function calculerTotaux() {
            try {
                const tbody = document.getElementById('tableBody');
                let totalHT = 0;
                
                Array.from(tbody.rows).forEach(row => {
                    const qte = parseFloat(row.querySelector('.qte').value) || 0;
                    const prix = parseFloat(row.querySelector('.prix').value) || 0;
                    totalHT += qte * prix;
                });
                
                // TVA: 20% standard (adapt√©e selon r√©gime fiscal conform√©ment Accord France-Monaco 1963)
const totalTVA = totalHT * 0.20;
                const totalTTC = totalHT + totalTVA;
                
                document.getElementById('totalHT').textContent = formaterNombre(totalHT) + ' ‚Ç¨';
                document.getElementById('totalTVA').textContent = formaterNombre(totalTVA) + ' ‚Ç¨';
                document.getElementById('totalTTC').textContent = formaterNombre(totalTTC) + ' ‚Ç¨';
            } catch (error) {
                console.warn('Erreur calcul totaux:', error);
            }
        }

        // FORMATER NOMBRE (format fran√ßais: virgule d√©cimale, espace milliers)
        function formaterNombre(num) {
            try {
                return num.toLocaleString('fr-FR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            } catch (error) {
                return num.toFixed(2).replace('.', ',');
            }
        }

        // VALIDATION AVANT IMPRESSION
        function validerDevis() {
            const erreurs = [];
            
            // V√©rifier champs obligatoires
            if (!document.getElementById('clientNom').value.trim()) {
                erreurs.push('- Nom du client');
            }
            if (!document.getElementById('devisNum').value.trim()) {
                erreurs.push('- Num√©ro de devis');
            }
            if (!document.getElementById('devisDate').value) {
                erreurs.push('- Date du devis');
            }
            
            // V√©rifier au moins une ligne avec description
            const tbody = document.getElementById('tableBody');
            let ligneValide = false;
            Array.from(tbody.rows).forEach(row => {
                if (row.querySelector('.designation').value.trim()) {
                    ligneValide = true;
                }
            });
            
            if (!ligneValide) {
                erreurs.push('- Au moins une prestation avec description');
            }
            
            if (erreurs.length > 0) {
                alert('‚ö†Ô∏è Champs obligatoires manquants:\n\n' + erreurs.join('\n') + '\n\nVeuillez compl√©ter ces informations avant d\'imprimer.');
                return false;
            }
            
            return true;
        }

        // IMPRIMER / EXPORT PDF
        function imprimer() {
            if (validerDevis()) {
                window.print();
            }
        }
    </script>
</body>
</html>
